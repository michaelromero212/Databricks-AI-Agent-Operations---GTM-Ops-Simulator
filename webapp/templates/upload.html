{% extends "layout.html" %}

{% block title %}Test Agent - GTM Ops{% endblock %}
{% block page_title %}Test Agent{% endblock %}
{% block page_subtitle %}Upload data for AI-powered analysis{% endblock %}

{% set active_page = 'upload' %}

{% block content %}
{% if success %}
<div class="alert alert-success">
    <div>
        <strong>âœ… Success!</strong> File "{{ filename }}" processed successfully<br>
        <span style="font-size: 0.875rem;">Confidence: {{ confidence }} | Time: {{ "%.2f"|format(resolution_time)
            }}s</span>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>ğŸ¤– Agent Response</h2>
        <p>AI-generated analysis</p>
    </div>
    <div class="card-body">
        <div class="agent-response">
            <div class="response-content">{{ result }}</div>

            <div class="feedback-buttons">
                <span style="font-size: 0.875rem; color: var(--gray-500); margin-right: 0.5rem;">Was this
                    helpful?</span>
                <button class="feedback-btn" onclick="submitFeedback(true)" title="Yes, helpful">ğŸ‘</button>
                <button class="feedback-btn" onclick="submitFeedback(false)" title="No, not helpful">ğŸ‘</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if error %}
<div class="alert alert-danger">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h2>ğŸ“¤ Upload File for Processing</h2>
        <p>Upload lead data, deal notes, or sales inputs for agent analysis</p>
    </div>
    <div class="card-body">
        <form action="/upload" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label class="form-label">Task Type</label>
                <select name="task_type" class="form-control" required>
                    <option value="lead_summary">Lead Summary</option>
                    <option value="follow_up">Follow-up Suggestions</option>
                    <option value="risk_analysis">Risk Analysis</option>
                    <option value="data_hygiene">Data Hygiene</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Select File (CSV, TXT, or JSON)</label>
                <input type="file" name="file" class="form-control" accept=".csv,.txt,.json" required>
            </div>

            <button type="submit" class="btn btn-accent btn-lg">
                ğŸš€ Upload & Process
            </button>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>ğŸ’¡ Example Input</h2>
        <p>Sample content you can save as a .txt file and upload</p>
    </div>
    <div class="card-body">
        <pre
            style="background: var(--gray-50); padding: 1rem; border-radius: 8px; overflow-x: auto; font-size: 0.875rem;">Lead Name: Sarah Chen
Company: TechVision Analytics
Industry: SaaS / Data Analytics
Source: Webinar Registration - "Modern Data Stack 2026"
Context:
- Downloaded lakehouse architecture whitepaper
- Company size: 200 employees
- Current stack: Snowflake, dbt, Fivetran
- Pain points mentioned: High costs, slow ELT, limited ML capabilities
- Next step: Discovery call scheduled for next week</pre>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
    <div class="card">
        <div class="card-body">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">ğŸ“‹ Lead Summary</h3>
            <p style="font-size: 0.875rem; color: var(--gray-500); margin: 0;">Analyzes lead data and provides
                qualification insights</p>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">ğŸ“§ Follow-up</h3>
            <p style="font-size: 0.875rem; color: var(--gray-500); margin: 0;">Suggests next actions based on
                interaction history</p>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">âš ï¸ Risk Analysis</h3>
            <p style="font-size: 0.875rem; color: var(--gray-500); margin: 0;">Identifies deal risks and mitigation
                strategies</p>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">ğŸ§¹ Data Hygiene</h3>
            <p style="font-size: 0.875rem; color: var(--gray-500); margin: 0;">Flags data quality issues and duplicates
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function submitFeedback(helpful) {
        const buttons = document.querySelectorAll('.feedback-btn');
        buttons.forEach(btn => btn.classList.remove('active-up', 'active-down'));

        if (helpful) {
            buttons[0].classList.add('active-up');
        } else {
            buttons[1].classList.add('active-down');
        }

        // TODO: Send feedback to server
        console.log('Feedback submitted:', helpful);
    }
</script>
{% endblock %}